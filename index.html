"use client";
import { useEffect, useRef, useState } from "react";

export default function Screensaver() {
  const logoRef = useRef(null);
  const catRef = useRef(null);
  const [catVisible, setCatVisible] = useState(false);
  const [catPosition, setCatPosition] = useState("top-left");
  const audioRefs = useRef([]);

  useEffect(() => {
    if (typeof window === "undefined") return;

    const screensaver = document.getElementById("screensaver");
    const logo = logoRef.current;
    const cat = catRef.current;

    let x = 100;
    let y = 100;
    let dx = 2;
    let dy = 2;
    const speed = 2;
    const logoSize = 80;

    const sounds = [
      "/meow1.mp3",
      "/meow2.mp3",
      "/meow3.mp3",
    ];
    audioRefs.current = sounds.map((src) => {
      const audio = new Audio(src);
      audio.volume = 0.5;
      return audio;
    });

    function randomMeow() {
      const rand = Math.floor(Math.random() * audioRefs.current.length);
      audioRefs.current[rand].play();
    }

    function showCat(position) {
      setCatPosition(position);
      setCatVisible(true);
      randomMeow();
      setTimeout(() => {
        setCatVisible(false);
      }, 1500);
    }

    function animate() {
      if (!screensaver || !logo) return;
      const sw = screensaver.clientWidth;
      const sh = screensaver.clientHeight;

      x += dx * speed;
      y += dy * speed;

      if (x + logoSize >= sw) {
        dx = -1;
        showCat("right");
      } else if (x <= 0) {
        dx = 1;
        showCat("left");
      }

      if (y + logoSize >= sh) {
        dy = -1;
        showCat("bottom");
      } else if (y <= 0) {
        dy = 1;
        showCat("top");
      }

      logo.style.transform = `translate(${x}px, ${y}px)`;
      requestAnimationFrame(animate);
    }

    animate();
  }, []);

  return (
    <div
      id="screensaver"
      className="w-screen h-screen bg-black overflow-hidden relative"
    >
      {/* Moving Logo */}
      <img
        ref={logoRef}
        src="/logo.png"
        alt="logo"
        className="absolute w-20 h-20"
      />

      {/* Cat Pop Animation */}
      {catVisible && (
        <img
          ref={catRef}
          src="/cat.png"
          alt="cat"
          className={`absolute w-40 h-40 transition-all duration-500 ${
            catPosition === "top" ? "top-0 left-1/2 -translate-x-1/2" : ""
          } ${catPosition === "bottom" ? "bottom-0 left-1/2 -translate-x-1/2" : ""}
          ${catPosition === "left" ? "left-0 top-1/2 -translate-y-1/2" : ""}
          ${catPosition === "right" ? "right-0 top-1/2 -translate-y-1/2" : ""}`}
        />
      )}
    </div>
  );
}
